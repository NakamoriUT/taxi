# 配送ルート最適化システム

## 概要
車両の積載量を考慮した配送ルート最適化システム。荷物量が車両容量を超える場合は、自動的に複数回に分割して配送します。

## 主な機能
- 📍 複数配送先の最適ルート計算
- 🚚 車両容量を超える荷物の自動分割配送
- 🗺️ 地図上でのルート表示とアニメーション
- ⚡ リアルタイムバリデーション
- 🔄 デポへの自動補充ルート生成
- 🛣️ 最低道幅制限によるルート最適化

## セットアップ

### 1. 必要なソフトウェア
- Python 3.8以上
- pip（Pythonパッケージマネージャー）

### 2. インストール
```bash
# リポジトリをクローン
git clone https://github.com/NakamoriUT/taxi.git
cd taxi

# 依存関係をインストール
pip install -r requirements.txt
```

### 3. 起動方法
```bash
python app.py
```

ブラウザで http://localhost:5000 にアクセス

※ macOSでポート5000が使用中の場合（AirPlay Receiverなど）：
```bash
PORT=8000 python app.py
```

## 使い方

1. **出発地点を設定**
   - 住所を入力して「住所を確認」をクリック
   - または「地図で選択」で地図上をクリック

2. **配送先を追加**
   - 住所と荷物量を入力
   - 必要に応じて時間帯や優先度を設定

3. **車両を設定**
   - 車両名と積載量を設定
   - 複数車両の追加も可能

4. **ルート設定（オプション）**
   - 最低道幅を選択（狭い道を避けたい場合）
   - 選択肢：制限なし、2.5m以上、3.0m以上、3.5m以上、4.0m以上

5. **ルート最適化**
   - 「ルートを最適化」ボタンをクリック
   - 荷物量が車両容量を超える場合は自動的に分割

## 分割配送機能
荷物量が車両の積載量を超える場合、システムは自動的に：
- 配送を複数回に分割
- 各配送間でデポに戻って補充
- 最適なルートを再計算

例：荷物量250、車両容量100の場合
→ 100 + 100 + 50の3回に分けて配送

## 道幅制限機能
大型車両や狭い道を避けたい場合に使用：
- **2.5m以上**：軽自動車向け（住宅街の狭い道を避ける）
- **3.0m以上**：普通車向け（標準的な配送）
- **3.5m以上**：大型車向け（2tトラックなど）
- **4.0m以上**：トラック向け（4tトラック以上）

狭い道を避けることで：
- 車両の安全な通行を確保
- 配送時間の予測精度向上
- ドライバーのストレス軽減

## 技術スタック
- Backend: Python Flask
- Frontend: JavaScript, Leaflet.js
- 最適化: Google OR-Tools
- 地図: OpenStreetMap

## ライセンス
MIT License